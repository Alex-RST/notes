# 第2章 Java内存区域与内存溢出异常

## 运行时数据区域
根据《Java虚拟机规范》的规定，Java虚拟机所管理的内存将包括以下几个运行时数据区域：
- **程序计数器**  
  一块较小区域，可以看作是字节码的行号指示器，用来指示下一条需要执行的指令。当线程正在执行一个Java方法，这个计数器应当记录正在执行的字节码指令地址；如果正在执行一个本地（Native）方法，计数器的值应为空（Undefined）。**线程私有**。唯一一个在《《Java虚拟机规范》》没有规定任何 `OutOfMemoryError` 情况的区域。
- **Java虚拟机栈**  
  虚拟机栈描述的是Java方法执行的线程内存模型：每个方法被执行的时候，Java虚拟机都会同步创建一个**栈帧**（Stack Frame）用于存储局部变量表、操作数栈、动态链接、方法出口等信息。每一个方法被调用直至执行完毕的过程，就对应着一个栈帧在虚拟机栈中从入栈到出栈的过程。**线程私有**。
- **本地方法栈**  
  与 **Java虚拟机栈** 非常相似，区别是本地方法栈是为本地（Native）方法服务。**线程私有**。
- **Java堆**  
  是虚拟机管理的最大的一块内存。此区域的唯一目的：**存放对象实例**。当前主流虚拟机都可实现扩展堆的大小（通过参数 `-Xms` 与 `-Xmx` 设定）。如果堆中没有空间完成实例分配，将抛出 `OutOfMemoryError` 异常。虚拟机启动时创建。**线程共享**。
- **方法区**  
  用于加载已被虚拟机加载的类型信息、常量、静态变量、即时编译后的代码缓存等数据。**线程共享**。运行是常量池是方法去的一部分，用于存放在编译器生成的各种字面量与符号引用。运行是常量池有一个重要特性：具备动态性；除了编译器产生的常量数据，运行时的数据也可存入。例如：`String` 类的 `intern()` 方法。

以上5个部分共同构成的Java虚拟机的运行时数据区域。但还有一个特殊的内存区域：**直接内存**。**直接内存**并不是虚拟机运行时数据区的一部分，也不是《Java虚拟机规范》中定义的内存区域。在 JDK1.4中新加入了NIO类，它可以使用Native函数库分配堆外内存，并通过存储在Java堆中DirectByteBuffer对象对这块内存进行操控。**因为避免了在Java堆与Native堆中来回复制数据，在某些情况能显著提升性能**。